"use strict";var Travis,entity,key,name,_i,_j,_len,_len1,_ref,_ref1,_ref2,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Travis=function(a){return new Travis.Session(a)},Travis.version="0.1.0",Travis.endpoints={org:"https://api.travis-ci.org",pro:"https://api.travis-ci.com"},Travis.endpoints["default"]=Travis.endpoints.org,Travis.callbacks={},Travis.globalCallbacks=[],Travis.callbacksFor=function(a){return Travis.globalCallbacks.concat(Travis.callbacks[a]||[])},Travis.notify=function(a,b){var c,d,e,f,g;for(f=Travis.callbacksFor(a),g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c({data:b,type:a}));return g},Travis.debug=function(){return Travis.on(function(a){return console.log(a.type,a.data)})},Travis.on=function(){var a,b,c,d,e,f,g;if(c=2<=arguments.length?__slice.call(arguments,0,d=arguments.length-1):(d=0,[]),a=arguments[d++],0===c.length)return Travis.globalCallbacks.push(a);for(g=[],e=0,f=c.length;f>e;e++)b=c[e],null==Travis.callbacks[b]&&(Travis.callbacks[b]=[]),g.push(Travis.callbacks[b].push(a));return g},"undefined"!=typeof module&&null!==module&&(module.exports=Travis),"undefined"!=typeof window&&null!==window&&(window.exports=Travis),this.Travis=Travis,Travis.Delegator={define:function(){var a,b,c,d,e,f,g;for(a=arguments[0],b=arguments[1],d=3<=arguments.length?__slice.call(arguments,2):[],g=[],e=0,f=d.length;f>e;e++)c=d[e],g.push(b[c]=this.delegator(a,b,c));return g},delegator:function(a,b,c){return function(){var d,e,f,g;return d=2<=arguments.length?__slice.call(arguments,0,g=arguments.length-1):(g=0,[]),e=arguments[g++],"function"==typeof e?b[c].apply(this,d).then(e):(d.push(e),f=b.call(a),new Travis.Promise(function(a){return f.then(function(b){var e;return e=b[c].apply(b,d),e.then(function(b){return a.succeed(b)}),e["catch"](function(b){return a.fail(b)})}),f["catch"](function(b){return a.fail(b)})}))}}},Travis.Entities={repository:{index:["id","slug"],one:["repo","repository"],many:["repos","repositories"]}},Travis.EntityMap={one:{},many:{}},_ref=Travis.Entities;for(name in _ref){for(entity=_ref[name],entity.name=name,_ref1=entity.one,_i=0,_len=_ref1.length;_len>_i;_i++)key=_ref1[_i],Travis.EntityMap.one[key]=entity;for(_ref2=entity.many,_j=0,_len1=_ref2.length;_len1>_j;_j++)key=_ref2[_j],Travis.EntityMap.many[key]=entity}Travis.Entity=function(){function a(a,b){this.session=a,this._store=b}return a.prototype.complete=function(a){return null==a&&(a=!0),null==this._fetch?!0:a&&null!=this.attributeNames&&this.hasAttributes()?!0:this._store().complete},a.prototype.hasAttributes=function(){var a,b,c,d,e,f,g,h;for(d=1<=arguments.length?__slice.call(arguments,0):[],0===d.length&&(d=this.attributeNames),b=this._store().data,e=0,f=d.length;f>e;e++)if(a=d[e],c=null!=(g=this.computedAttributes)&&null!=(h=g[a])?h.dependsOn:void 0){if(!this.hasAttributes.apply(this,c))return!1}else if(void 0===b[this._apiName(a)])return!1;return!0},a.prototype.attributes=function(){var a,b,c,d,e,f;if(b=2<=arguments.length?__slice.call(arguments,0,e=arguments.length-1):(e=0,[]),a=arguments[e++],"string"==typeof a&&b.push(a),0===b.length&&(b=this.attributeNames,null!=this.computedAttributes)){f=this.computedAttributes;for(key in f)d=f[key],b.push(key)}return c=this.complete(!1)||this.hasAttributes.apply(this,b)?new Travis.Promise(function(a){return function(c){return c.succeed(a._attributes(b))}}(this)):this._fetch().wrap(function(a){return function(){return a._attributes(b)}}(this)),c.then(a)},a.prototype._attributes=function(a){var b,c,d,e,f,g,h,i;for(d=this._store().data,e={},c={},g=0,h=a.length;h>g;g++)name=a[g],(b=null!=(i=this.computedAttributes)?i[name]:void 0)?c[name]=b:e[name]=d[this._apiName(name)];for(key in c)f=c[key],e[key]=f.compute(d);return e},a.prototype._clientName=function(a){return a.replace(/_([a-z])/g,function(a){return a[1].toUpperCase()})},a.prototype._apiName=function(a){return a.replace(/[A-Z]/g,function(a){return"_"+a[0].toLowerCase()})},a}(),Travis.HTTP=function(){function a(a){var b,c;this.base=a.base,this.defaultHeaders=a.headers||{},null==(c=this.defaultHeaders)["User-Agent"]&&(c["User-Agent"]="travis.js/"+Travis.version+" "+Travis.System.info()),"undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest?(b=a.xhrHeaders||["content-type","cache-control","expires","etag","last-modified"],this.rawRequest=function(a,c){var d,e,f;d=new XMLHttpRequest,d.open(a.method,a.url,!0),f=a.headers;for(name in f)e=f[name],"user-agent"!==name.toLowerCase()&&d.setRequestHeader(name,e);return d.onreadystatechange=function(){var a,e,f,g;if(4===d.readyState){for(e={},f=0,g=b.length;g>f;f++)a=b[f],e[a.toLowerCase()]=d.getResponseHeader(a);return c(d.status,e,d.responseText)}},d.send(a.body)}):(this.url=require("url"),this.adapters={"http:":require("http"),"https:":require("https")},this.rawRequest=function(a,b){var c,d,e,f,g;return e=this.url.parse(a.url),g="",c=this.adapters[e.protocol]||this.adapters["http:"],d={host:e.hostname,path:e.path,method:a.method,headers:a.headers},null!=e.port&&(d.port=e.port),f=c.request(d,function(a){return a.on("data",function(a){return g+=a}),a.on("end",function(){return b(a.statusCode,a.headers,g)})}),f.on("error",function(a){throw a}),null!=a.body&&f.write(a.body),f.end()})}return a.prototype.get=function(a,b,c){return this.request("GET",a,b,c)},a.prototype.head=function(a,b,c){return this.request("HEAD",a,b,c)},a.prototype.post=function(a,b,c){return this.request("POST",a,b,c)},a.prototype.put=function(a,b,c){return this.request("PUT",a,b,c)},a.prototype.patch=function(a,b,c){return this.request("PATCH",a,b,c)},a.prototype["delete"]=function(a,b,c){return this.request("DELETE",a,b,c)},a.prototype.request=function(a,b,c,d){var e,f;return d=this.prepareRequest(a,b,c,d),e=this,f=new Travis.Promise(function(b){var c,f;return c=function(b,c,d){var e;return e={status:b,headers:c,body:d},null!=d&&"HEAD"!==a&&/^application\/json/.test(c["content-type"])&&(e.body=JSON.parse(d)),Travis.notify("http:response",e),e},(f=function(d,g){var h;for(key in g)h=g[key],d[key]=h;return Travis.notify("http:request",d),e.rawRequest(d,function(e,g,h){switch(e){case 200:case 201:case 204:return b.succeed(c(e,g,h));case 301:case 302:case 303:return f(d,{url:g.location,method:"HEAD"===a?a:"GET"});case 307:case 308:return f(d,{url:g.location});default:return b.fail(c(e,g,h))}})})(d)}),null!=d.callback&&f.then(d.callback),f},a.prototype.prepareRequest=function(a,b,c,d){var e,f;if(null==b)throw new Error("path is missing");"function"==typeof d&&(d={callback:d}),null==d&&(d={}),d.method=a,null==d.headers&&(d.headers={}),d.url=/^https?:/.test(b)?b:""+this.base+b,f=this.defaultHeaders;for(key in f)e=f[key],null==d.headers[key]&&(d.headers[key]=e);return"function"==typeof c&&(d.callback=c,c=null),null!=c&&this.setParams(d,c),d},a.prototype.setParams=function(a,b){return"HEAD"===a.method||"GET"===a.method?this.setQueryParams(a,b):this.setBody(a,b)},a.prototype.setBody=function(a,b){return"string"!=typeof b&&(a.headers["Content-Type"]="application/json",b=JSON.stringify(b)),a.body=b},a.prototype.setQueryParams=function(a,b){var c,d,e;if(c=a.url.indexOf("?")>=0?"&":"?","string"==typeof b)return a.url+=""+c+b;e=[];for(key in b)d=b[key],a.url+=""+c+encodeURIComponent(key)+"="+encodeURIComponent(d),e.push(c="&");return e},a}(),Travis.Promise=function(){function a(a){this._onSuccess=[],this._onFailure=[],this.data=null,this.closure=a,this.setState("sleeping")}return a.prototype.setState=function(a,b){return null!=b&&(this.data=b),this.sleeping="sleeping"===a,this.running="running"===a,this.failed="failed"===a,this.succeeded="succeeded"===a,this},a.prototype.run=function(){return this.sleeping&&(this.setState("running"),this.closure(this)),this},a.prototype.succeed=function(a){var b,c,d,e;for(this.setState("succeeded",a),Travis.notify("promise:succeed",a),e=this._onSuccess,c=0,d=e.length;d>c;c++)(b=e[c])(this.data);return this._onSuccess=[],this._onFailure=[],this},a.prototype.fail=function(a){var b,c,d,e;for(this.setState("failed",a),Travis.notify("promise:fail",a),e=this._onFailure,c=0,d=e.length;d>c;c++)(b=e[c])(this.data);return this._onSuccess=[],this._onFailure=[],this},a.prototype.onSuccess=function(a){return this.then(a,null,!1)},a.prototype.onFailure=function(a){return this.then(null,a,!1)},a.prototype.wrap=function(a){var b,c;return c=this,b=new Travis.Promise(function(){return c.run()}),this.then(function(c){return b.succeed(a(c))},function(a){return b.fail(a)},!1),b},a.prototype.then=function(a,b,c){return null==c&&(c=null),null===c&&(c=null!=a||null!=b),null!=a&&void 0===b&&(b=function(a){throw a}),this.succeeded?null!=a&&a(this.data):this.failed?null!=b&&b(this.data):(null!=a&&this._onSuccess.push(a),null!=b&&this._onFailure.push(b),c&&this.run()),this},a.prototype["catch"]=function(a){return this.then(null,a),this},a}(),Travis.Session=function(){function a(a){var b;null==a&&(a={}),"string"==typeof a&&(a={url:Travis.endpoints[a]||a}),this._options=a,b={Accept:"application/vnd.travis-ci.2+json"},null!=a.token&&(b.Authorization="token "+a.token),this.http=new Travis.HTTP({headers:b,base:a.url||Travis.endpoints["default"]}),this.data={},Travis.Delegator.define(this,this.github,"get")}return a.prototype.repository=function(a){return"string"==typeof a&&(a={slug:a}),"number"==typeof a&&(a={id:a}),this.entity("repository",a)},a.prototype.repositories=function(a,b){return this.load("/repos",a,b,function(a){return a.repos})},a.prototype.load=function(a,b,c,d){var e;return null==d&&(d=function(a){return a}),"function"==typeof b&&(e=b,b={}),this.http.get(a,b).wrap(function(a){return function(b){return d(a.loadData(b.body))}}(this)).then(e).then(c)},a.prototype.loadData=function(a){var b,c,d,e,f,g,h;e={};for(c in a)if(f=a[c],d=Travis.EntityMap.one[c])(entity=this.entity(d,f))&&(e[c]=entity);else if(d=Travis.EntityMap.many[c])for(e[c]=[],g=0,h=f.length;h>g;g++)b=f[g],(entity=this.entity(d,b))&&e[c].push(entity);return e},a.prototype._entity=function(a,b,c){var d,e;return d=Travis.Entity[a.name]||Travis.Entity,e=function(d){return function(){return d._entityData(a,b,c)}}(this),new d(this,e)},a.prototype._entityData=function(a,b,c){var d,e,f;return d=null!=(e=this.data)[f=a.name]?e[f]:e[f]={},d=null!=d[b]?d[b]:d[b]={},null!=d[c]?d[c]:d[c]={data:{},complete:!1}},a.prototype._parseField=function(a,b){return/_at$/.test(a)&&null!=b?new Date(Date.parse(b)):b},a.prototype.entity=function(a,b,c){var d,e,f,g,h,i,j;for(null==c&&(c=!1),"string"==typeof a&&(a=Travis.Entities[a]),entity=null,j=a.index,h=0,i=j.length;i>h;h++)if(e=j[h],d=b[e]){null==entity&&(entity=this._entity(a,e,d)),f=this._entityData(a,e,d),c&&(f.complete=!0);for(key in b)g=b[key],f.data[key]=this._parseField(key,g)}return entity},a.prototype.session=function(a){var b,c;c=this._options;for(key in c)b=c[key],null==a[key]&&(a[key]=b);return new Travis.Session(a)},a.prototype.config=function(a){var b;return null==(b=this.config).promise&&(b.promise=this.http.get("/config").wrap(function(a){return a.body.config})),this.config.promise.then(a)},a.prototype.github=function(a){var b;return null==(b=this.github).promise&&(b.promise=this.config().wrap(function(a){return new Travis.HTTP({base:a.github.api_url})})),this.github.promise.then(a)},a.prototype.authenticate=function(a,b){var c;return"string"==typeof a&&(a={token:a}),null!=a.token?(c=new Travis.Promise,c.succeed(this.session({token:a.token}))):null!=a.githubToken?c=this.http.post("/auth/github",{github_token:a.githubToken}).wrap(function(a){return function(b){return a.session({token:b.body.access_token})}}(this)):null!=a.githubUser&&null!=a.githubPassword?c.fail(new Error("github password auth not yet supported")):c=new Travis.Promise(function(a){return a.fail(new Error("token or githubToken required"))}),c.then(b)},a.prototype.clearCache=function(){return this.data={},this},a}(),Travis.System={info:function(){return null!=("undefined"!=typeof navigator&&null!==navigator?navigator.userAgent:void 0)?navigator.userAgent:"undefined"!=typeof process&&null!==process?"node/"+process.versions.node+" ("+process.platform+") v8/"+process.versions.v8:"unknown"},base64:function(a){return"undefined"!=typeof Buffer&&null!==Buffer?new Buffer(a).toString("base64"):btoa(a)}},Travis.Entity.repository=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.attributeNames=["id","slug","description","lastBuildId","lastBuildNumber","lastBuildState","lastBuildDuration","lastBuildStartedAt","lastBuildFinishedAt","githubLanguage"],b.prototype.computedAttributes={ownerName:{dependsOn:["slug"],compute:function(a){return a.slug.split("/",1)[0]}},name:{dependsOn:["slug"],compute:function(a){return a.slug.split("/",2)[1]}}},b.prototype._fetch=function(){var a;return a=this._store().data,this.session.load("/repos/"+(a.id||a.slug))},b}(Travis.Entity);
//# sourceMappingURL=travis.min.js.map